<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/services/toolActivateMgr.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/services/toolActivateMgr.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>goog.provide('ngeo.ToolActivate');
goog.provide('ngeo.ToolActivateMgr');

goog.require('ngeo');


/**
 * A simple object that can be managed by `ngeo.ToolActivateMgr`.
 *
 * @param {Object} toolContext An object which acts as the context for the tool.
 * @param {string} activePropertyName The name of a boolean property on
 *      `toolContext` which represents the active state of the tool.
 * @constructor
 * @ngdoc value
 * @ngname ngeoToolActivate
 */
ngeo.ToolActivate = function(toolContext, activePropertyName) {

  /**
   * A getter function to get the active state of the tool.
   * @return {boolean} Is active.
   * @export
   */
  this.getActive = function() {
    return toolContext[activePropertyName];
  };

  /**
   * A setter function to set the active state of the tool.
   * @param {boolean} newVal New active state.
   * @export
   */
  this.setActive = function(newVal) {
    toolContext[activePropertyName] = newVal;
  };
};


ngeo.module.value('ngeoToolActivate', ngeo.ToolActivate);


/**
 * An entry for a tool in a `ngeo.ToolActivateMgr` group.
 * @typedef {{
 *    tool: (ngeo.ToolActivate),
 *    defaultTool: boolean,
 *    unlisten: (function(): void)}}
 */
ngeo.ToolMgrEntry;


/**
 * Provides a service to manage the activation of `ngeo.toolActivate` objects.
 *
 * Example:
 *
 * Each tool must be registered before using it.
 *
 *     var tool = new ngeo.ToolActivate(interaction, 'active');
 *     ngeoToolActivateMgr.registerTool('mapTools', tool);
 *
 * A tool will be registered in a group identified by a group name.
 * Once registered a tool can be activated and deactivated. When activating a
 * tool, all others tools in the same group will be deactivated.
 *
 *     ngeoToolActivateMgr.activateTool(tool);
 *     ngeoToolActivateMgr.deactivateTool(tool);
 *
 * @param {angular.Scope} $rootScope The rootScope provider.
 * @constructor
 * @ngdoc service
 * @ngname ngeoToolActivateMgr
 * @ngInject
 */
ngeo.ToolActivateMgr = function($rootScope) {

  /**
   * @type {!Object.&lt;string, Array.&lt;ngeo.ToolMgrEntry>>}
   * @private
   */
  this.groups_ = {};

  /**
   * The scope.
   * @type {angular.Scope}
   * @private
   */
  this.scope_ = $rootScope;
};


/**
 * Register a tool.
 * @param {string} groupName Name of the group of this tool.
 * @param {ngeo.ToolActivate} tool Tool to register.
 * @param {boolean=} opt_defaultActivate If true, this tool will be activated
 *     when all other tools in the group are deactivated.
 */
ngeo.ToolActivateMgr.prototype.registerTool = function(groupName, tool,
    opt_defaultActivate) {
  var entries = this.groups_[groupName];
  if (!entries) {
    entries = this.groups_[groupName] = [];
  }

  var unlisten = this.scope_.$watch(
      tool.getActive,
      (function(newVal, oldVal) {
        if (newVal === oldVal) {
          return;
        }
        if (newVal) {
          this.deactivateTools_(groupName, tool);
        } else {
          this.activateDefault_(groupName);
        }
      }).bind(this));

  entries.push({
    tool: tool,
    defaultTool: opt_defaultActivate || false,
    unlisten: unlisten
  });

  if (goog.asserts.ENABLE_ASSERTS) {
    // check that only one default tool per group exists
    var defaultTools = 0;
    entries.forEach(function(entry) {
      if (entry.defaultTool) {
        defaultTools++;
      }
    });
    goog.asserts.assert(
        defaultTools &lt;= 1, 'more than one default tool in group ' + groupName);
  }
};


/**
 * Unregister a tool from a group.
 * @param {string} groupName Name of the group of this tool.
 * @param {ngeo.ToolActivate} tool Tool to unregister.
 * @export
 */
ngeo.ToolActivateMgr.prototype.unregisterTool = function(groupName, tool) {
  var entries = this.groups_[groupName];
  if (entries) {
    for (var i = 0; i &lt; entries.length; i++) {
      if (entries[i].tool == tool) {
        entries[i].unlisten();
        entries.splice(i, 1);
        break;
      }
    }
  }
};


/**
 * Unregister each tool from a group.
 * @param {string} groupName Name of the group of tools to unregister.
 * @export
 */
ngeo.ToolActivateMgr.prototype.unregisterGroup = function(groupName) {
  var entries = this.groups_[groupName];
  if (entries) {
    for (var i = 0; i &lt; entries.length; i++) {
      entries[i].unlisten();
    }
    delete this.groups_[groupName];
  }
};


/**
 * Activate a tool.
 * @param {ngeo.ToolActivate} tool Tool to activate.
 * @export
 */
ngeo.ToolActivateMgr.prototype.activateTool = function(tool) {
  tool.setActive(true);
};


/**
 * Deactivate a tool.
 * @param {ngeo.ToolActivate} tool Tool to deactivate.
 * @export
 */
ngeo.ToolActivateMgr.prototype.deactivateTool = function(tool) {
  tool.setActive(false);
};


/**
 * Deactivate all tools except the given one.
 *
 * @param {string} groupName Name of the group.
 * @param {ngeo.ToolActivate} tool Tool to activate.
 * @private
 */
ngeo.ToolActivateMgr.prototype.deactivateTools_ = function(groupName, tool) {
  var entries = this.groups_[groupName];
  for (var i = 0; i &lt; entries.length; i++) {
    if (tool != entries[i].tool) {
      entries[i].tool.setActive(false);
    }
  }
};


/**
 * Activate the default tool in the given group if no other tool is active.
 *
 * @param {string} groupName Name of the group.
 * @private
 */
ngeo.ToolActivateMgr.prototype.activateDefault_ = function(groupName) {
  var entries = this.groups_[groupName];
  var defaultTool = null;
  var hasActiveTool = false;

  for (var i = 0; i &lt; entries.length; i++) {
    hasActiveTool = hasActiveTool || entries[i].tool.getActive();

    if (entries[i].defaultTool) {
      defaultTool = entries[i].tool;
    }
  }

  if (!hasActiveTool &amp;&amp; defaultTool !== null) {
    defaultTool.setActive(true);
  }
};


ngeo.module.service('ngeoToolActivateMgr', ngeo.ToolActivateMgr);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h2>gmf</h2><h3>Directives</h3><ul><li><a href="gmf.authenticationDirective.html">authenticationDirective</a></li><li><a href="gmf.layertreeDirective.html">layertreeDirective</a></li><li><a href="gmf.mapDirective.html">mapDirective</a></li><li><a href="gmf.mobileBackgroundLayerSelectorDirective.html">mobileBackgroundLayerSelectorDirective</a></li><li><a href="gmf.mobiledisplayqueriesDirective.html">mobiledisplayqueriesDirective</a></li><li><a href="gmf.mobileMeasureLengthDirective.html">mobileMeasureLengthDirective</a></li><li><a href="gmf.mobileMeasurePointDirective.html">mobileMeasurePointDirective</a></li><li><a href="gmf.searchDirective.html">searchDirective</a></li><li><a href="gmf.themeselectorDirective.html">themeselectorDirective</a></li></ul><h3>Services</h3><ul><li><a href="gmf.Altitude.html">Altitude</a></li><li><a href="gmf.Permalink.html">Permalink</a></li><li><a href="gmf.QueryManager.html">QueryManager</a></li><li><a href="gmf.Themes.html">Themes</a></li></ul><h3>Controllers</h3><ul><li><a href="gmf.AuthenticationController.html">AuthenticationController</a></li><li><a href="gmf.LayertreeController.html">LayertreeController</a></li><li><a href="gmf.MapController.html">MapController</a></li><li><a href="gmf.MobileBackgroundLayerSelectorController.html">MobileBackgroundLayerSelectorController</a></li><li><a href="gmf.MobileMeasureLengthController.html">MobileMeasureLengthController</a></li><li><a href="gmf.MobileMeasurePointController.html">MobileMeasurePointController</a></li><li><a href="gmf.MobileNavController.html">MobileNavController</a></li><li><a href="gmf.SearchController.html">SearchController</a></li><li><a href="gmf.ThemeselectorController.html">ThemeselectorController</a></li></ul><h3>Classes</h3><ul><li><a href="gmf.AbstractController.html">AbstractController</a></li><li><a href="gmf.AbstractDesktopController.html">AbstractDesktopController</a></li><li><a href="gmf.AbstractMobileController.html">AbstractMobileController</a></li><li><a href="gmf.Authentication.html">Authentication</a></li><li><a href="gmf.MobiledisplayqueriesController.html">MobiledisplayqueriesController</a></li></ul><h3>Types</h3><ul><li><a href="gmf.html#AuthenticationDefaultResponse">AuthenticationDefaultResponse</a></li><li><a href="gmf.html#AuthenticationFunctionalities">AuthenticationFunctionalities</a></li><li><a href="gmf.html#AuthenticationLoginResponse">AuthenticationLoginResponse</a></li><li><a href="gmf.html#ExportFeatures">ExportFeatures</a></li><li><a href="gmf.html#ThemesResponse">ThemesResponse</a></li><li><a href="gmf.html#User">User</a></li></ul><h3>Enumerations</h3><ul><li><a href="gmf.html#AltitudeParam">AltitudeParam</a></li><li><a href="gmf.html#AuthenticationRouteSuffix">AuthenticationRouteSuffix</a></li><li><a href="gmf.html#ExportFormat">ExportFormat</a></li><li><a href="gmf.html#PermalinkParam">PermalinkParam</a></li><li><a href="gmf.html#ThemesEventType">ThemesEventType</a></li></ul><h2>gmf.source</h2><h3>Classes</h3><ul><li><a href="gmf.source.AsitVD.html">AsitVD</a></li><li><a href="gmf.source.Swisstopo.html">Swisstopo</a></li></ul><h2>ngeo</h2><h3>Directives</h3><ul><li><a href="ngeo.btnDirective.html">btnDirective</a></li><li><a href="ngeo.btngroupDirective.html">btngroupDirective</a></li><li><a href="ngeo.controlDirective.html">controlDirective</a></li><li><a href="ngeo.desktopGeolocationDirective.html">desktopGeolocationDirective</a></li><li><a href="ngeo.filereaderDirective.html">filereaderDirective</a></li><li><a href="ngeo.layertreeDirective.html">layertreeDirective</a></li><li><a href="ngeo.mapDirective.html">mapDirective</a></li><li><a href="ngeo.mobileGeolocationDirective.html">mobileGeolocationDirective</a></li><li><a href="ngeo.mobileQueryDirective.html">mobileQueryDirective</a></li><li><a href="ngeo.modalDirective.html">modalDirective</a></li><li><a href="ngeo.profileDirective.html">profileDirective</a></li><li><a href="ngeo.recenterDirective.html">recenterDirective</a></li><li><a href="ngeo.resizemapDirective.html">resizemapDirective</a></li><li><a href="ngeo.scaleselectorDirective.html">scaleselectorDirective</a></li><li><a href="ngeo.searchDirective.html">searchDirective</a></li><li><a href="ngeo.sortableDirective.html">sortableDirective</a></li></ul><h3>Services</h3><ul><li><a href="ngeo.BackgroundLayerMgr.html">BackgroundLayerMgr</a></li><li><a href="ngeo.CreateGeoJSONBloodhound.html">CreateGeoJSONBloodhound</a></li><li><a href="ngeo.createPrintServiceFactory.html">createPrintServiceFactory</a></li><li><a href="ngeo.Debounce.html">Debounce</a></li><li><a href="ngeo.DecorateGeolocation.html">DecorateGeolocation</a></li><li><a href="ngeo.DecorateInteraction.html">DecorateInteraction</a></li><li><a href="ngeo.DecorateLayer.html">DecorateLayer</a></li><li><a href="ngeo.FeatureOverlayMgr.html">FeatureOverlayMgr</a></li><li><a href="ngeo.getBrowserLanguageFactory.html">getBrowserLanguageFactory</a></li><li><a href="ngeo.LayerHelper.html">LayerHelper</a></li><li><a href="ngeo.Location.html">Location</a></li><li><a href="ngeo.Popup.html">Popup</a></li><li><a href="ngeo.PrintUtils.html">PrintUtils</a></li><li><a href="ngeo.Query.html">Query</a></li><li><a href="ngeo.SyncArrays.html">SyncArrays</a></li><li><a href="ngeo.ToolActivateMgr.html">ToolActivateMgr</a></li></ul><h3>Controllers</h3><ul><li><a href="ngeo.BtnGroupController.html">BtnGroupController</a></li><li><a href="ngeo.DesktopGeolocationController.html">DesktopGeolocationController</a></li><li><a href="ngeo.LayertreeController.html">LayertreeController</a></li><li><a href="ngeo.MobileGeolocationController.html">MobileGeolocationController</a></li><li><a href="ngeo.MobileQueryController.html">MobileQueryController</a></li><li><a href="ngeo.ScaleselectorController.html">ScaleselectorController</a></li></ul><h3>Classes</h3><ul><li><a href="ngeo.BackgroundEvent.html">BackgroundEvent</a></li><li><a href="ngeo.FeatureOverlay.html">FeatureOverlay</a></li><li><a href="ngeo.MeasureEvent.html">MeasureEvent</a></li><li><a href="ngeo.Print.html">Print</a></li><li><a href="ngeo.profile.html">profile</a></li><li><a href="ngeo.StateManager.html">StateManager</a></li><li><a href="ngeo.ToolActivate.html">ToolActivate</a></li></ul><h3>Types</h3><ul><li><a href="ngeo.html#CreatePopup">CreatePopup</a></li><li><a href="ngeo.html#CreatePrint">CreatePrint</a></li><li><a href="ngeo.html#FeatureOverlayGroup">FeatureOverlayGroup</a></li><li><a href="ngeo.html#GetBrowserLanguage">GetBrowserLanguage</a></li><li><a href="ngeo.html#MockLocationProvider">MockLocationProvider</a></li><li><a href="ngeo.html#QueryCacheItem">QueryCacheItem</a></li><li><a href="ngeo.html#QueryResult">QueryResult</a></li><li><a href="ngeo.html#QueryResultSource">QueryResultSource</a></li><li><a href="ngeo.html#ScaleselectorOptions">ScaleselectorOptions</a></li><li><a href="ngeo.html#SortableOptions">SortableOptions</a></li><li><a href="ngeo.html#ToolMgrEntry">ToolMgrEntry</a></li></ul><h3>Enumerations</h3><ul><li><a href="ngeo.html#BackgroundEventType">BackgroundEventType</a></li><li><a href="ngeo.html#MeasureEventType">MeasureEventType</a></li><li><a href="ngeo.html#PrintStyleType">PrintStyleType</a></li><li><a href="ngeo.html#QueryInfoFormatType">QueryInfoFormatType</a></li></ul><h2>ngeo.format</h2><h3>Classes</h3><ul><li><a href="ngeo.format.FeatureHash.html">FeatureHash</a></li></ul><h3>Enumerations</h3><ul><li><a href="ngeo.format.html#FeatureHashStyleType">FeatureHashStyleType</a></li></ul><h2>ngeo.interaction</h2><h3>Classes</h3><ul><li><a href="ngeo.interaction.DrawAzimut.html">DrawAzimut</a></li><li><a href="ngeo.interaction.Measure.html">Measure</a></li><li><a href="ngeo.interaction.MeasureArea.html">MeasureArea</a></li><li><a href="ngeo.interaction.MeasureAzimut.html">MeasureAzimut</a></li><li><a href="ngeo.interaction.MeasureLength.html">MeasureLength</a></li><li><a href="ngeo.interaction.MeasureLengthMobile.html">MeasureLengthMobile</a></li><li><a href="ngeo.interaction.MeasurePointMobile.html">MeasurePointMobile</a></li><li><a href="ngeo.interaction.MobileDraw.html">MobileDraw</a></li></ul><h3>Types</h3><ul><li><a href="ngeo.interaction.html#MeasureBaseOptions">MeasureBaseOptions</a></li></ul><h3>Enumerations</h3><ul><li><a href="ngeo.interaction.html#MobileDrawProperty">MobileDrawProperty</a></li></ul><h2>ngeo.MeasureEvent</h2><h3>Events</h3><ul><li><a href="ngeo.MeasureEvent.html#event:measureend">measureend</a></li></ul><h2>ngeox</h2><h3>Interfaces</h3><ul><li><a href="ngeox.BackgroundEvent.html">BackgroundEvent</a></li><li><a href="ngeox.MeasureEvent.html">MeasureEvent</a></li></ul><h3>Types</h3><ul><li><a href="ngeox.html#DesktopGeolocationDirectiveOptions">DesktopGeolocationDirectiveOptions</a></li><li><a href="ngeox.html#MobileGeolocationDirectiveOptions">MobileGeolocationDirectiveOptions</a></li><li><a href="ngeox.html#QueryOptions">QueryOptions</a></li><li><a href="ngeox.html#QuerySource">QuerySource</a></li><li><a href="ngeox.html#SearchDirectiveListeners">SearchDirectiveListeners</a></li></ul><h2>gmfx</h2><h3>Types</h3><ul><li><a href="gmfx.html#Config">Config</a></li><li><a href="gmfx.html#SearchDirectiveDatasource">SearchDirectiveDatasource</a></li><li><a href="gmfx.html#ServiceUrls">ServiceUrls</a></li></ul><h2>gmfx.source</h2><h3>Types</h3><ul><li><a href="gmfx.source.html#AsitVDOptions">AsitVDOptions</a></li><li><a href="gmfx.source.html#SwisstopoOptions">SwisstopoOptions</a></li></ul><h2>ngeox.format</h2><h3>Types</h3><ul><li><a href="ngeox.format.html#FeatureHashOptions">FeatureHashOptions</a></li></ul><h2>ngeox.interaction</h2><h3>Types</h3><ul><li><a href="ngeox.interaction.html#MeasureOptions">MeasureOptions</a></li><li><a href="ngeox.interaction.html#MobileDrawOptions">MobileDrawOptions</a></li></ul><h2>ngeox.profile</h2><h3>Types</h3><ul><li><a href="ngeox.profile.html#ElevationExtractor">ElevationExtractor</a></li><li><a href="ngeox.profile.html#PoiExtractor">PoiExtractor</a></li><li><a href="ngeox.profile.html#ProfileFormatter">ProfileFormatter</a></li><li><a href="ngeox.profile.html#ProfileOptions">ProfileOptions</a></li></ul><h3>Global</h3><ul><li><a href="global.html#gmfx">gmfx</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
